<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>MVC - Javascript</title>
</head>

<body>


<select id="selAnimal">
    <option value="cat">cat</option>
    <option value="fish">fish</option>
    <option value="bird">bird</option>
</select>

<p id="whatDoesThisAnimalDo"></p>

<script type="text/javascript">
var whatDoesAnimalDo = {};

// model层
whatDoesAnimalDo.model = {
    // animal的数据
    animalDictionary: {
        cat: "meows",
        fish: "swims",
        bird: "flies"
    },
    // 当前的animal，也就是这个application的状态
    currentAnimal: null,
    // 数据模型负责业务逻辑和数据存储
    setAnimal: function(animalName) {
        this.currentAnimal = this.animalDictionary[animalName] ? animalName : null;
        this.onModelChange();
    },
    // 并且通知视图更新显示
    onModelChange: function() {
        whatDoesAnimalDo.presenter.sendModelChange(this.getAnimalAction());
    },
    // 还需要响应视图对当前状态的查询
    getAnimalAction: function() {
        return this.currentAnimal ? this.currentAnimal + " " + this.animalDictionary[this.currentAnimal] : "wuff?";
    }
};





// View视图层
whatDoesAnimalDo.view = {
    // 用户输入触发onchange事件
    start: function() {
        document.getElementById('selAnimal').onchange = this.onViewChange;
    },
    // 该事件将用户请求发送给控制器
    onViewChange: function() {
        whatDoesAnimalDo.presenter.sendViewChange(document.getElementById('selAnimal').value);
    },
    // 视图更新显示的方法，其中视图会向model查询当前的状态，并将其显示给用户
    update: function(data) {
        document.getElementById('whatDoesThisAnimalDo').innerHTML = data;
    }
};

// presenter 层
whatDoesAnimalDo.presenter = {
    // 选择视图
    start: function() {
        whatDoesAnimalDo.view.start();
    },
    // 将用户的操作映射到模型的更新上
    sendViewChange: function(animalName) {
        whatDoesAnimalDo.model.setAnimal(animalName);
    },
	// 将模型的更新映射到View视图上
    sendModelChange: function(data) {
        whatDoesAnimalDo.view.update(data);
    }
};

whatDoesAnimalDo.presenter.start();

</script>
</body>
</html>